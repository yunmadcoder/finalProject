<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<style>
th>span {
	font-weight: 600;
}

.nav-link.active {
	color: #5A6A85 !important;
}
</style>

<div class="card rounded-0 flex-fill m-0" style="min-height: 800px;">
	<div class="card-body p-0">
		<div class="m-3 ms-4">
			<h3 class="m-0">업무 기안</h3>
		</div>
		<ul class="nav nav-underline ms-4 border-bottom" id="draftTab">
			<li class="nav-item"><a class="nav-link <c:if test='${type == "all"}'>active</c:if>" href="#" id="allLink">
					<span>전체</span>
				</a></li>
			<li class="nav-item"><a class="nav-link <c:if test='${type == "inprogress"}'>active</c:if>" href="#" id="inprogressLink">
					<span>진행</span>
				</a></li>
			<li class="nav-item"><a class="nav-link <c:if test='${type == "complete"}'>active</c:if>" href="#" id="completeLink">
					<span>완료</span>
				</a></li>
			<li class="nav-item"><a class="nav-link <c:if test='${type == "return"}'>active</c:if>" href="#" id="returnLink">
					<span>반려</span>
				</a></li>
		</ul>
		<table class="table table-borderless w-100" id="tbl">
			<colgroup>
				<col width="5%">
				<col width="10%">
				<col width="10%">
				<col width="10%">
				<col width="45%">
				<col width="10%">
			</colgroup>
			<thead class="border-bottom text-start table-hover">
				<tr>
					<th>
						<input type="checkbox" class="form-check-input" id="selectAll">
					</th>
					<th>
						<span>기안일</span>
					</th>
					<th>
						<span>결재양식</span>
					</th>
					<th>
						<span>긴급</span>
					</th>
					<th>
						<span>제목</span>
					</th>
					<th>
						<span>첨부</span>
					</th>
					<th>
						<span>결재상태</span>
					</th>
				</tr>
			</thead>
			<tbody id="tbody">
				<c:if test="${empty approvalList}">
					<c:set var="msg" value="상신한 문서가 존재하지 않습니다." />
					<c:choose>
						<c:when test="${type eq 'inprogress'}">
							<c:set var="msg" value="진행중인 문서가 존재하지 않습니다." />
						</c:when>
						<c:when test="${type eq 'complete'}">
							<c:set var="msg" value="결재 완료한 문서가 존재하지 않습니다." />
						</c:when>
						<c:when test="${type eq 'return'}">
							<c:set var="msg" value="반려된 문서가 존재하지 않습니다." />
						</c:when>
					</c:choose>
					<tr>
						<td colspan="7">
							<p class="p-3 text-center">${msg }</p>
						</td>
					</tr>
				</c:if>
				<c:if test="${not empty approvalList }">
					<c:forEach items="${approvalList }" var="approval">
						<tr>
							<td>
								<input class="form-check-input" type="checkbox" name="select">
							</td>
							<td>${approval.submitDt }</td>
							<td>${approval.docNm }</td>
							<td>
								<c:choose>
									<c:when test="${approval.emrgncyYn == 'Y'}">
										<i class="fa-solid fa-light-emergency-on fa-fade fa-xl" style="color: #ff0000;"></i>
									</c:when>
									<c:otherwise>
										<i class="fa-solid fa-light-emergency-on fa-light fa-xl" style="color: #999999;"></i>
									</c:otherwise>
								</c:choose>
							</td>
							<td>
								<a href="/approval/document/${approval.aprovlNo }"> ${approval.aprovlNm } </a>
							</td>
							<td>
								<c:if test="${approval.atchFileGroupNo != null }">
									<div>
										<i class="fa-sharp fa-regular fa-paperclip fa-fw"></i>
										<span>${approval.fileCount }</span>
									</div>
								</c:if>
							</td>
							<td>
								<c:choose>
									<c:when test="${approval.aprovlSttusCode eq 'G101' }">
										<c:set var="state" value="approval-temp" />
									</c:when>
									<c:when test="${approval.aprovlSttusCode eq 'G102' }">
										<c:set var="state" value="approval-ongoing" />
									</c:when>
									<c:when test="${approval.aprovlSttusCode eq 'G103' }">
										<c:set var="state" value="approval-finish" />
									</c:when>
									<c:when test="${approval.aprovlSttusCode eq 'G104' }">
										<c:set var="state" value="approval-return" />
									</c:when>
								</c:choose>
								<span class="badge ${state }"> ${approval.aprovlSttusNm } </span>
							</td>
						</tr>
					</c:forEach>
				</c:if>

			</tbody>
		</table>
	</div>
</div>

<script>
let draftTab = $('#draftTab');

draftTab.on('click', 'a', function(e) {
	e.preventDefault();
	let links = ['allLink', 'inprogressLink', 'completeLink', 'returnLink'];
	let id = $(this).attr('id');
	let href = '/approval/doclist/draft/';
	
	let isLink = links.find(link => link == id);
	
	if(isLink) {
		if(id == 'allLink') {
			href += 'all';
		}else if (id == 'inprogressLink'){
			href += 'inprogress';			
		}else if (id == 'completeLink'){
			href += 'complete';
		}else {
			href += 'return';
		}
	}
	
	location.href = href;
});

$('#tbl').on('change', 'input[type="checkbox"]', function() {
	if($(this).attr('id') == 'selectAll') {
		if($(this).is(":checked")) $("input[name=select]").prop("checked", true);
		else $("input[name=select]").prop("checked", false);
	}else{
		if($(this).attr('name') == 'select') {
			var total = $("input[name=select]").length;
			var checked = $("input[name=select]:checked").length;

			if(total != checked) $("#selectAll").prop("checked", false);
			else $("#selectAll").prop("checked", true); 
		} 
	}
});
</script>